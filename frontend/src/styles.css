@tailwind base;
@tailwind components;
@tailwind utilities;

/* ============================================
   DESIGN TOKENS
   ============================================ */

@layer base {
  :root {
    color-scheme: dark;

    /* Surface colors — Nord Polar Night (RGB for alpha support) */
    --color-surface-base: 46 52 64;        /* #2E3440 - deepest (inputs) */
    --color-surface-elevated: 59 66 82;    /* #3B4252 - cards */
    --color-surface-overlay: 67 76 94;     /* #434C5E - inner cards */

    /* Border colors — Nord Polar Night */
    --color-border: 76 86 106;             /* #4C566A */
    --color-border-muted: 59 66 82;        /* #3B4252 */

    /* Text colors — Nord Snow Storm + Frost */
    --color-content: 236 239 244;          /* #ECEFF4 */
    --color-content-muted: 216 222 233;    /* #D8DEE9 */
    --color-content-subtle: 163 208 207;   /* #A3D0CF - Frost (lightened for AA at small sizes) */
    --color-content-inverse: 46 52 64;     /* #2E3440 */

    /* Accent colors — Nord Aurora yellow (gold) */
    --color-accent: 235 203 139;           /* #EBCB8B */
    --color-accent-hover: 216 186 116;     /* #D8BA74 - deeper gold */
    --color-accent-muted: 76 72 56;        /* dark gold-tinted bg */
    --color-accent-text: 235 203 139;      /* #EBCB8B */

    /* Success colors — Nord Aurora green */
    --color-success: 163 190 140;          /* #A3BE8C */
    --color-success-muted: 52 66 52;       /* dark green bg */
    --color-success-text: 163 190 140;     /* #A3BE8C */

    /* Error colors — Nord Aurora red */
    --color-error: 191 97 106;             /* #BF616A */
    --color-error-muted: 74 51 56;         /* dark red bg */
    --color-error-text: 219 168 173;       /* #DBA8AD - light pink for AA */
  }

  body {
    background-color: #5E81AC; /* Nord Frost blue — Dynamic Skillset brand */
    @apply text-content;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
      "Segoe UI", sans-serif;
  }
}

/* ============================================
   COMPONENT STYLES
   ============================================ */

@layer components {
  /* Skip link for accessibility */
  .skip-link {
    @apply absolute -top-10 left-4 z-50 rounded-input bg-accent px-4 py-2 text-sm font-semibold text-content-inverse transition-all;
  }

  .skip-link:focus {
    @apply top-4;
  }

  /* Card containers */
  .card {
    @apply rounded-card border border-border-muted bg-surface-elevated p-6 shadow-card;
  }

  .card-inner {
    @apply rounded-xl border border-border bg-surface-overlay p-4;
  }

  /* Form inputs */
  .input {
    @apply w-full rounded-input border border-border bg-surface-elevated px-3 py-2.5 text-sm text-content placeholder-content-subtle transition-colors;
    @apply focus:border-accent-hover focus:outline-none focus:ring-2 focus:ring-accent/40;
  }

  .input-dark {
    @apply w-full rounded-input border border-border bg-surface-base px-3 py-2.5 text-sm text-content placeholder-content-subtle transition-colors;
    @apply focus:border-accent-hover focus:outline-none focus:ring-2 focus:ring-accent/40;
  }

  /* Select — custom arrow for consistent dark theme across browsers */
  .select {
    @apply w-full rounded-input border border-border bg-surface-elevated px-3 py-2.5 pr-8 text-sm text-content transition-colors;
    @apply focus:border-accent-hover focus:outline-none focus:ring-2 focus:ring-accent/40;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23D8DEE9' d='M6 8.825a.5.5 0 0 1-.354-.146L2.354 5.387a.5.5 0 1 1 .707-.707L6 7.618l2.939-2.938a.5.5 0 1 1 .707.707L6.354 8.679A.5.5 0 0 1 6 8.825z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 0.625rem center;
    background-size: 0.75rem;
  }

  /* Checkbox — cross-browser dark theme (fixes Firefox rendering) */
  .checkbox {
    @apply h-5 w-5 shrink-0 cursor-pointer rounded border border-border bg-surface-base transition-colors;
    appearance: none;
    display: grid;
    place-content: center;
  }

  .checkbox::before {
    content: "";
    width: 0.65em;
    height: 0.65em;
    clip-path: polygon(14% 44%, 0 65%, 50% 100%, 100% 16%, 80% 0%, 43% 62%);
    transform: scale(0);
    transition: transform 0.1s ease-in-out;
    box-shadow: inset 1em 1em rgb(var(--color-content-inverse));
  }

  .checkbox:checked {
    @apply border-accent bg-accent;
  }

  .checkbox:checked::before {
    transform: scale(1);
  }

  .checkbox:focus-visible {
    @apply outline-2 outline-offset-2 outline-accent;
  }

  /* Labels */
  .label {
    @apply block text-sm font-medium text-content/90;
  }

  .label-hint {
    @apply mt-1 text-xs text-content-subtle;
  }

  /* Buttons */
  .btn {
    @apply inline-flex min-h-touch items-center justify-center rounded-input px-5 py-2.5 text-sm font-semibold transition-colors;
    @apply focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent;
    @apply disabled:cursor-not-allowed disabled:opacity-60;
  }

  .btn-primary {
    @apply btn bg-accent text-content-inverse shadow hover:bg-accent-hover;
  }

  .btn-secondary {
    @apply btn border border-border text-content hover:border-accent hover:text-accent-text;
  }

  .btn-ghost {
    @apply btn text-content-muted hover:text-content;
  }

  .btn-light {
    @apply btn bg-content text-content-inverse hover:bg-[#E5E9F0];
  }

  /* Time slot pills */
  .slot-pill {
    @apply min-h-touch rounded-pill px-4 py-2 text-xs font-medium transition-colors;
    @apply focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent;
  }

  .slot-pill-default {
    @apply slot-pill bg-surface-overlay text-content hover:bg-border;
  }

  .slot-pill-selected {
    @apply slot-pill bg-accent text-content-inverse;
  }

  /* Feedback alerts */
  .alert {
    @apply rounded-input border p-3 text-sm;
  }

  .alert-error {
    @apply alert border-error/60 bg-error-muted/40 text-error-text;
  }

  .alert-success {
    @apply alert border-success/60 bg-success-muted/40 text-success-text;
  }

  .alert-info {
    @apply alert border-accent/40 bg-accent-muted/30 text-content-muted;
  }

  /* Week view cells */
  .week-cell {
    @apply flex min-h-touch items-center justify-center text-xs;
  }

  .week-cell-available {
    @apply week-cell cursor-pointer text-accent-text transition-colors hover:bg-accent/10;
  }

  .week-cell-selected {
    @apply week-cell cursor-pointer bg-accent text-content-inverse;
  }

  .week-cell-busy {
    @apply week-cell text-content-subtle;
  }

  .week-header-cell {
    @apply text-center text-xs font-medium uppercase tracking-wider text-content-muted;
  }

  .week-time-label {
    @apply pr-2 text-right text-xs text-content-subtle;
  }

  .week-nav-btn {
    @apply inline-flex h-touch w-touch items-center justify-center rounded-input text-content-muted transition-colors hover:bg-surface-overlay hover:text-content;
    @apply focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent;
  }

  /* Mini calendar cells — fill grid column, min 44px tap target on interactive cells */
  .mini-cal-cell {
    @apply flex h-9 w-full items-center justify-center rounded-full text-xs;
  }

  .mini-cal-available {
    @apply mini-cal-cell cursor-pointer text-accent-text hover:bg-accent/10;
  }

  .mini-cal-unavailable {
    @apply mini-cal-cell text-content-subtle;
  }

  .mini-cal-selected {
    @apply mini-cal-cell cursor-pointer bg-accent text-content-inverse;
  }

  .mini-cal-outside {
    @apply mini-cal-cell text-content-subtle/65;
  }

  .mini-cal-dot {
    @apply mx-auto mt-0.5 h-1 w-1 rounded-full bg-accent;
  }

  /* Honeypot field — visually hidden but not display:none (bots detect that) */
  .honeypot-field {
    position: absolute;
    left: -9999px;
    height: 0;
    overflow: hidden;
    opacity: 0;
  }

  /* Loading skeleton */
  .skeleton {
    @apply animate-pulse rounded bg-surface-overlay;
  }
}

/* ============================================
   UTILITY CLASSES
   ============================================ */

@layer utilities {
  /* Required field indicator */
  .required-indicator::after {
    content: " *";
    @apply text-error;
  }

  /* Emoji spacing — subtle letter-spacing for emoji sequences */
  .emoji-spaced {
    letter-spacing: 0.1em;
  }

  /* Text overflow utilities */
  .text-truncate {
    @apply overflow-hidden text-ellipsis whitespace-nowrap;
  }

  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
}

/* ============================================
   ACCESSIBILITY
   ============================================ */

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

/* Focus visible for keyboard navigation */
:focus-visible {
  @apply outline-2 outline-offset-2 outline-accent;
}

/* Remove default focus outline when using mouse */
:focus:not(:focus-visible) {
  outline: none;
}

/* High contrast mode support */
@media (forced-colors: active) {
  .btn-primary,
  .btn-secondary {
    border: 2px solid currentColor;
  }

  .card,
  .card-inner {
    border: 1px solid currentColor;
  }
}
